{% extends layout_path %}

{% load static %}
{% load i18n %}

{% block title %}Send Student{% endblock %}

{% block vendor_css %}
{{ block.super }}
<link rel="stylesheet" href="{% static 'vendor/libs/datatables-bs5/datatables.bootstrap5.css' %}" />
<link rel="stylesheet" href="{% static 'vendor/libs/datatables-responsive-bs5/responsive.bootstrap5.css' %}" />
<link rel="stylesheet" href="{% static 'vendor/libs/datatables-buttons-bs5/buttons.bootstrap5.css' %}" />
<link rel="stylesheet" href="{% static 'vendor/libs/select2/select2.css' %}" />
<link rel="stylesheet" href="{% static 'vendor/libs/toastr/toastr.css' %}" />
<link rel="stylesheet" href="{% static 'vendor/libs/sweetalert2/sweetalert2.css' %}" />
<style>
  #studentsTable .badge {
    font-size: 0.75rem; /* Kichikroq badge */
    padding: 0.4em 0.6em; /* Kichikroq padding */
  }
</style>
{% endblock vendor_css %}

{% block vendor_js %}
{{ block.super }}
{#  <script src="{% static 'vendor/libs/jquery/jquery.js' %}"></script>#}
<script src="{% static 'vendor/libs/moment/moment.js' %}"></script>
<script src="{% static 'vendor/libs/datatables-bs5/datatables-bootstrap5.js' %}"></script>
<script src="{% static 'vendor/libs/select2/select2.js' %}"></script>
<script src="{% static 'vendor/libs/toastr/toastr.js' %}"></script>
<script src="{% static 'vendor/libs/sweetalert2/sweetalert2.js' %}"></script>
{% endblock vendor_js %}

{% block page_js %}
{{ block.super }}
  <script>
  document.addEventListener("DOMContentLoaded", function () {
    const regionSelect = document.getElementById("studentRegion");
    const districtSelect = document.getElementById("studentDistrict");
    const schoolSelect = document.getElementById("studentSchool");

    const viloyatlar = {{ viloyatlar|safe }}; // Rendered from Django context

    regionSelect.addEventListener("change", function () {
        const selectedRegion = this.value;

        // Populate Tumans
        districtSelect.innerHTML = '<option value="" selected disabled>Tumanni tanlang</option>';
        schoolSelect.innerHTML = '<option value="" selected disabled>Maktabni tanlang</option>';
        schoolSelect.disabled = true;

        if (viloyatlar[selectedRegion]) {
            districtSelect.disabled = false;
            for (const district in viloyatlar[selectedRegion]) {
                districtSelect.innerHTML += `<option value="${district}">${district}</option>`;
            }
        }
    });

    districtSelect.addEventListener("change", function () {
        const selectedRegion = regionSelect.value;
        const selectedDistrict = this.value;

        // Populate Maktabs
        schoolSelect.innerHTML = '<option value="" selected disabled>Maktabni tanlang</option>';
        if (viloyatlar[selectedRegion] && viloyatlar[selectedRegion][selectedDistrict]) {
            schoolSelect.disabled = false;
            viloyatlar[selectedRegion][selectedDistrict].forEach((school) => {
                schoolSelect.innerHTML += `<option value="${school.id}">${school.maktab_raqami} - ${school.nomi}</option>`;
            });
        }
    });
});

  </script>
{% endblock page_js %}

{% block content %}
<div class="card shadow-sm p-4">
  <h4 class="card-title text-center mb-4"><i class="ti ti-user-plus"></i> O'quvchini Taklif Qilish</h4>
  <form id="submit-student-form" method="POST">
    {% csrf_token %}
    <div class="row g-3">
      <!-- Ismi va Familiyasi -->
      <div class="col-md-4">
        <label for="studentFirstName" class="form-label">
          <i class="ti ti-user"></i> Ismi
        </label>
        <input type="text" class="form-control" id="studentFirstName" placeholder="Ismi" required />
      </div>
      <div class="col-md-4">
        <label for="studentLastName" class="form-label">
          <i class="ti ti-user"></i> Familiyasi
        </label>
        <input type="text" class="form-control" id="studentLastName" placeholder="Familiyasi" required />
      </div>
      <div class="col-md-4">
        <label for="studentPhone" class="form-label">
          <i class="ti ti-phone"></i> Telefon raqami
        </label>
        <input type="text" class="form-control" id="studentPhone" value="+998" placeholder="Telefon" required />
      </div>
    </div>

    <div class="row g-3 mt-3">
      <!-- Viloyat, Tuman va Maktab -->
      <div class="col-md-4">
        <label for="studentRegion" class="form-label">
          <i class="ti ti-map-pin"></i> Viloyat
        </label>
        <select class="form-select" id="studentRegion" required>
          <option value="" selected disabled>Viloyatni tanlang</option>
          <!-- Dynamically populated -->
        </select>
      </div>
      <div class="col-md-4">
        <label for="studentDistrict" class="form-label">
          <i class="ti ti-map-pin"></i> Tuman
        </label>
        <select class="form-select" id="studentDistrict" required>
          <option value="" selected disabled>Tumanni tanlang</option>
          <!-- Dynamically populated -->
        </select>
      </div>
      <div class="col-md-4">
        <label for="studentSchool" class="form-label">
          <i class="ti ti-building"></i> Maktab
        </label>
        <select class="form-select" id="studentSchool" required>
          <option value="" selected disabled>Maktabni tanlang</option>
          <!-- Dynamically populated -->
        </select>
      </div>
    </div>

    <div class="row g-3 mt-3">
      <!-- Sinf va Belgisi -->
      <div class="col-md-4">
        <label for="studentGrade" class="form-label">
          <i class="ti ti-book"></i> Sinf
        </label>
        <select class="form-select" id="studentGrade" required>
          <option value="" selected disabled>Sinfni tanlang</option>
          {% for grade in grades %}
          <option value="{{ grade }}">{{ grade }}-sinf</option>
          {% endfor %}
        </select>
      </div>
      <div class="col-md-4">
        <label for="studentSection" class="form-label">
          <i class="ti ti-id-badge"></i> Sinf Belgisi
        </label>
        <input type="text" class="form-control" id="studentSection" placeholder="A, B, C" maxlength="1" required />
      </div>
    </div>

    <div class="row g-3 mt-3">
      <!-- O'quv markazi va Filial -->
      <div class="col-md-4">
        <label for="studentCenter" class="form-label">
          <i class="ti ti-building-skyscraper"></i> O'quv markazi
        </label>
        <select class="form-select select2" id="studentCenter" required>
          <option value="" selected disabled>Markazni tanlang</option>
          <!-- Dynamically populated -->
        </select>
      </div>
      <div class="col-md-4">
        <label for="studentBranch" class="form-label">
          <i class="ti ti-map"></i> Filial
        </label>
        <select class="form-select select2" id="studentBranch" required disabled>
          <option value="" selected disabled>Filialni tanlang</option>
          <!-- Dynamically populated -->
        </select>
      </div>
    </div>

    <div class="row g-3 mt-3">
      <!-- Kasb -->
      <div class="col-md-4">
        <label for="studentProfession" class="form-label">
          <i class="ti ti-briefcase"></i> Kasb
        </label>
        <select class="form-select" id="studentProfession" required>
          <option value="" selected disabled>Kasbni tanlang</option>
          <!-- Dynamically populated -->
        </select>
      </div>
      <!-- Yo'nalish -->
      <div class="col-md-4">
        <label for="studentField" class="form-label">
          <i class="ti ti-compass"></i> Yo'nalish
        </label>
        <select class="form-select" id="studentField" required disabled>
          <option value="" selected disabled>Yo'nalishni tanlang</option>
          <!-- Dynamically populated -->
        </select>
      </div>
      <!-- Kurs -->
      <div class="col-md-4">
        <label for="studentCourse" class="form-label">
          <i class="ti ti-graduation-cap"></i> Kurs
        </label>
        <select class="form-select" id="studentCourse" multiple required disabled>
          <option value="" selected disabled>Kurs tanlang</option>
          <!-- Dynamically populated -->
        </select>
      </div>
    </div>

    <div class="mt-4 d-flex justify-content-center">
      <button type="submit" class="btn btn-primary btn-lg px-5">
        <i class="ti ti-send"></i> Yuborish
      </button>
    </div>
  </form>
</div>



{% endblock %}






